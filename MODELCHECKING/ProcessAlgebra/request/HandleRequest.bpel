<!-- HandleRequest BPEL Process [Generated by the Eclipse BPEL Designer] -->
<!-- Date: Fri Aug 24 16:10:02 CEST 2018 -->
<process name="HandleRequest"
         targetNamespace="http://handerequest.ws.ou"
         suppressJoinFailure="yes"
         xmlns:tns="http://handerequest.ws.ou"
         xmlns:bpel="http://docs.oasis-open.org/wsbpel/2.0/process/executable"
         xmlns:ns1="http://www.w3.org/2001/XMLSchema" xmlns:ns="http://request.ws.ou">

    <!-- Import the client WSDL -->
    <import namespace="http://request.ws.ou" location="HandleRequestWS.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"></import>
    <import location="HandleRequestArtifacts.wsdl" namespace="http://handerequest.ws.ou" 
	        importType="http://schemas.xmlsoap.org/wsdl/" />
         
    <!-- ================================================================= -->         
    <!-- PARTNERLINKS                                                      -->
    <!-- List of services participating in this BPEL process               -->
    <!-- ================================================================= -->         
    <partnerLinks>
        <!-- The 'client' role represents the requester of this service. -->
        <partnerLink name="client"
                     partnerLinkType="tns:HandleRequest"
                     myRole="HandleRequestProvider"
                     />
        <partnerLink name="HandleRequestWSPL" partnerLinkType="tns:HandleRequestWSPLType" partnerRole="HandleRequestWSPLRole"></partnerLink>
    </partnerLinks>
  
    <!-- ================================================================= -->         
    <!-- VARIABLES                                                         -->
    <!-- List of messages and XML documents used within this BPEL process  -->
    <!-- ================================================================= -->         
    <variables>
        <!-- Reference to the message passed as input during initiation -->
        <variable name="handleRequestInput"
                  messageType="tns:HandleRequestRequestMessage"/>
                  
        <variable name="handleRequestOutput"
                  messageType="tns:HandleRequestResponseMessage"/>
        <variable name="reinject" type="ns1:string"></variable>
        <variable name="service" type="ns1:string"></variable>
        <variable name="ok" type="ns1:string"></variable>
        <variable name="handleComplexRequestInput" messageType="tns:handleComplexRequestRequest"></variable>
        <variable name="handleComplexRequestOutput" messageType="tns:handleComplexRequestResponse"></variable>
        <variable name="rejectRequestInput" messageType="tns:rejectRequestRequest"></variable>
        <variable name="rejectRequestOutput" messageType="tns:rejectRequestResponse"></variable>
        <variable name="reinjectRequestInput" messageType="tns:reinjectRequestRequest"></variable>
        <variable name="reinjectRequestOutput" messageType="tns:reinjectRequestResponse"></variable>
        <variable name="rejectRequestWSResp" messageType="ns:rejectRequestWSResponse"></variable>
        <variable name="rejectRequestWSReq" messageType="ns:rejectRequestWSRequest"></variable>
        <variable name="exception" messageType="ns:WsException"></variable>
        <variable name="createExceptionTaskWSResponse" messageType="ns:createExceptionTaskResponse"></variable>
        <variable name="createExceptionTaskWSRequest" messageType="ns:createExceptionTaskRequest"></variable>
        <variable name="payload" type="ns1:string"></variable>
        <variable name="checkProcessabilityWSResponse" messageType="ns:checkProcessabilityResponse"></variable>
        <variable name="checkProcessabilityWSRequest" messageType="ns:checkProcessabilityRequest"></variable>
        <variable name="handleRequestWSResponse" messageType="ns:processRequestResponse"></variable>
        <variable name="handleRequestWSRequest" messageType="ns:processRequestRequest"></variable>
        <variable name="valid" type="ns1:string"></variable>
        <variable name="classifyRequestWSResponse" messageType="ns:classifyRequestResponse"></variable>
        <variable name="classifyRequestWSRequest" messageType="ns:classifyRequestRequest"></variable>
        <variable name="requestType" type="ns1:string"></variable>
        <variable name="createManualTaskWSResponse" messageType="ns:createManualTaskResponse"></variable>
        <variable name="createManualTaskWSRequest" messageType="ns:createManualTaskRequest"></variable>
    </variables>

    <!-- ================================================================= -->         
    <!-- ORCHESTRATION LOGIC                                               -->
    <!-- Set of activities coordinating the flow of messages across the    -->
    <!-- services integrated within this business process                  -->
    <!-- ================================================================= -->         
    <sequence name="RequestHandler">
        
        
        <pick name="HandleService" createInstance="yes">
            <onMessage partnerLink="client" operation="handleRequest" portType="tns:HandleRequest" variable="handleRequestInput">
                <assign validate="no" name="PrepareHandleRequest">
                    <copy>
                        <from>
                            <literal xml:space="preserve">N</literal>
                        </from>
                        <to variable="reinject"></to>
                    </copy>
                    <copy>
                        <from>
                            <literal xml:space="preserve">handleRequest</literal>
                        </from>
                        <to variable="service"></to>
                    </copy>
                    
                    
                    
                    <copy>
                        <from>
                            <literal xml:space="preserve">Ok</literal>
                        </from>
                        <to variable="ok"></to>
                    </copy>
                    <copy>
                        <from part="parameters" variable="handleRequestInput">
                            <query queryLanguage="urn:oasis:names:tc:ws2.0:sublang:xpath1.0">
                                <![CDATA[tns:payload]]>
                            </query>
                        </from>
                        <to variable="payload"></to>
                    </copy>
                </assign>
            </onMessage>
            <onMessage partnerLink="client" operation="handleComplexRequest" portType="tns:HandleRequest" variable="handleComplexRequestInput">
                <assign validate="no" name="PrepareHandleComplexRequest">
                    <copy>
                        <from>
                            <literal xml:space="preserve">N</literal>
                        </from>
                        <to variable="reinject"></to>
                    </copy>
                    <copy>
                        <from>
                            <literal xml:space="preserve">handleComplexRequest</literal>
                        </from>
                        <to variable="service"></to>
                    </copy>
                    
                    <copy>
                        <from>
                            <literal xml:space="preserve">Ok</literal>
                        </from>
                        <to variable="ok"></to>
                    </copy>
                    <copy>
                        <from part="parameters" variable="handleComplexRequestInput">
                            <query queryLanguage="urn:oasis:names:tc:ws2.0:sublang:xpath1.0"><![CDATA[tns:payload]]></query>
                        </from>
                        <to variable="payload"></to>
                    </copy>
                </assign>
            </onMessage>
            <onMessage partnerLink="client" operation="rejectRequest" portType="tns:HandleRequest" variable="rejectRequestInput">
                <assign validate="no" name="PrepareRejectRequest">
                    <copy>
                        <from>
                            <literal xml:space="preserve">N</literal>
                        </from>
                        <to variable="reinject"></to>
                    </copy>
                    <copy>
                        <from>
                            <literal xml:space="preserve">rejectRequest</literal>
                        </from>
                        <to variable="service"></to>
                    </copy>
                    
                    <copy>
                        <from>
                            <literal xml:space="preserve">Ok</literal>
                        </from>
                        <to variable="ok"></to>
                    </copy>
                    <copy>
                        <from part="parameters" variable="rejectRequestInput">
                            <query queryLanguage="urn:oasis:names:tc:ws2.0:sublang:xpath1.0"><![CDATA[tns:payload]]></query>
                        </from>
                        <to variable="payload"></to>
                    </copy>
                </assign>
            </onMessage>
            <onMessage partnerLink="client" operation="reinjectRequest" portType="tns:HandleRequest" variable="reinjectRequestInput">
                <assign validate="no" name="PrepareReinjectRequest">
                    <copy>
                        <from>
                            <literal xml:space="preserve">Y</literal>
                        </from>
                        <to variable="reinject"></to>
                    </copy>
                    
                    
                    
                    <copy>
                        <from part="parameters" variable="reinjectRequestInput">
                            <query queryLanguage="urn:oasis:names:tc:ws2.0:sublang:xpath1.0"><![CDATA[tns:service]]></query>
                        </from>
                        <to variable="service"></to>
                    </copy>
                    
                    <copy>
                        <from>
                            <literal xml:space="preserve">Ok</literal>
                        </from>
                        <to variable="ok"></to>
                    </copy>
                    <copy>
                        <from part="parameters" variable="reinjectRequestInput">
                            <query queryLanguage="urn:oasis:names:tc:ws2.0:sublang:xpath1.0"><![CDATA[tns:payload]]></query>
                        </from>
                        <to variable="payload"></to>
                    </copy>
                </assign>
            </onMessage>
        </pick>
        
        
        <!-- Generate reply to synchronous request -->
        
        
        <if name="HandleService">
            <condition expressionLanguage="urn:oasis:names:tc:ws2.0:sublang:xpath1.0"><![CDATA[$service='handleRequest']]></condition>
            <sequence name="HandleRequestSequence">
                <sequence name="InvokeClassifyRequest">
	                <assign validate="no" name="PrepareClassifyRequest">
	                	<copy>
	                    	<from><literal><impl:classifyRequest xmlns:impl="http://request.ws.ou" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
							  	<impl:requestInput>
								    <impl:payload>impl:payload</impl:payload>
								</impl:requestInput>
								</impl:classifyRequest>
								</literal></from>
	                        <to variable="classifyRequestWSRequest" part="parameters"></to>
	                    </copy>
	                    <copy>
	                    	<from variable="payload"></from>
	                        <to part="parameters" variable="classifyRequestWSRequest">
	                            <query queryLanguage="urn:oasis:names:tc:ws2.0:sublang:xpath1.0"><![CDATA[ns:requestInput/ns:payload]]></query>
	                        </to>
	                    </copy>
                    </assign>
	                <invoke name="ClassifyRequestWS" partnerLink="HandleRequestWSPL" operation="classifyRequest" portType="ns:HandleRequestWS" inputVariable="classifyRequestWSRequest" outputVariable="classifyRequestWSResponse">
	       	        	<catch faultName="ns:WsException" faultVariable="exception" faultMessageType="ns:WsException">
	                    	<sequence name="CreateExceptionTask">
	                        	<assign validate="no" name="PrepareExceptionTask">
		                        	<copy>
		                            	<from><literal><impl:createExceptionTask xmlns:impl="http://request.ws.ou" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
											<impl:requestInput>
											<impl:exceptionPoint>impl:exceptionPoint</impl:exceptionPoint>
											<impl:payload>impl:payload</impl:payload>
											<impl:triggerEvent>impl:triggerEvent</impl:triggerEvent>
											</impl:requestInput>
											</impl:createExceptionTask>
											</literal>
										</from>
	                                    <to variable="createExceptionTaskWSRequest" part="parameters"></to>
	                              	</copy>
	                                    
	                                <copy>
	                                   	<from variable="service"></from>
	                                   	<to part="parameters" variable="createExceptionTaskWSRequest">
	                                       	<query queryLanguage="urn:oasis:names:tc:ws2.0:sublang:xpath1.0">
	                                                <![CDATA[ns:requestInput/ns:triggerEvent]]>
	                                            	</query>
	                                   	</to>
	                                </copy>
                               </assign>
                               
                               <invoke name="InvokeCreateExceptionTask" partnerLink="HandleRequestWSPL" operation="createExceptionTask" portType="ns:HandleRequestWS" inputVariable="createExceptionTaskWSRequest" outputVariable="createExceptionTaskWSResponse"></invoke>
                               <throw name="StopProcess"></throw>
                            </sequence>
                        </catch>
                	</invoke>

                    <assign validate="no" name="AssignRequestType">
                        <copy>
                            <from part="parameters" variable="classifyRequestWSResponse">
                                <query queryLanguage="urn:oasis:names:tc:ws2.0:sublang:xpath1.0"><![CDATA[ns:classifyRequestReturn/ns:value]]></query>
                            </from>
                            <to variable="requestType"></to>
                        </copy>
                    </assign>
          		</sequence>
          		<!-- "InvokeClassifyRequest"> -->
          		
                <if name="IfStandardRequest">
                    <condition expressionLanguage="urn:oasis:names:tc:ws2.0:sublang:xpath1.0"><![CDATA[$requestType='S']]></condition>
                    <sequence name="HandleStandardRequest">
                        <sequence name="InvokeCheckProcessability">
                        	<assign validate="no" name="PrepareCheckProcessability">
                                <copy>
	                                <from><literal><impl:checkProcessability xmlns:impl="http://request.ws.ou" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
										  <impl:requestInput>
										    <impl:payload>impl:payload</impl:payload>
										  </impl:requestInput>
										</impl:checkProcessability>
										</literal>
									</from>
	                                <to variable="checkProcessabilityWSRequest" part="parameters"></to>
                            	</copy>
                            	
                            	<copy>
	                                <from variable="payload"></from>
	                                <to part="parameters" variable="checkProcessabilityWSRequest">
	                                        <query queryLanguage="urn:oasis:names:tc:ws2.0:sublang:xpath1.0">
	                                            <![CDATA[ns:requestInput/ns:payload]]>
	                                        </query>
                                    </to>
	                            </copy>
                        	</assign>
                        	
                        	<invoke name="CheckProcessabilityWS" partnerLink="HandleRequestWSPL" operation="checkProcessability" portType="ns:HandleRequestWS" inputVariable="checkProcessabilityWSRequest" outputVariable="checkProcessabilityWSResponse">
                            <catch faultName="ns:WsException" faultVariable="exception" faultMessageType="ns:WsException">
                                <sequence name="CreateExceptionTask">
                                	<assign validate="no" name="PrepareExceptionTask">
		                                <copy>
	    	                                <from>
	    	                                	<literal><impl:createExceptionTask xmlns:impl="http://request.ws.ou" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
												  <impl:requestInput>
												    <impl:exceptionPoint>impl:exceptionPoint</impl:exceptionPoint>
												    <impl:payload>impl:payload</impl:payload>
												    <impl:triggerEvent>impl:triggerEvent</impl:triggerEvent>
												  </impl:requestInput>
												</impl:createExceptionTask>
												</literal></from>
	                                       	<to variable="createExceptionTaskWSRequest" part="parameters"></to>
	                               	   	</copy>
	                                            
	                                    <copy>
	                                        <from variable="service"></from>
	                                        <to part="parameters" variable="createExceptionTaskWSRequest">
	                                                    <query queryLanguage="urn:oasis:names:tc:ws2.0:sublang:xpath1.0">
	                                                        <![CDATA[ns:requestInput/ns:triggerEvent]]>
	                                                    </query>
	                                        </to>
	                                    </copy>
                                	</assign>
                                
                                	<invoke name="InvokeCreateExceptionTask" partnerLink="HandleRequestWSPL" operation="createExceptionTask" portType="ns:HandleRequestWS" inputVariable="createExceptionTaskWSRequest" outputVariable="createExceptionTaskWSResponse"></invoke>
                                	<throw name="StopProcess"></throw>
                            
                        		</sequence>
                        	</catch>
                        	</invoke>
    
                            <assign validate="no" name="AssignValid">
	                            <copy>
	                                <from part="parameters" variable="checkProcessabilityWSResponse">
	                                    <query queryLanguage="urn:oasis:names:tc:ws2.0:sublang:xpath1.0"><![CDATA[ns:checkProcessabilityReturn/ns:value]]></query>
	                                </from>
	                                <to variable="valid"></to>
	                            </copy>
	                        </assign>
                            
                  		</sequence>
                        
                        <if name="IfValid">
                            <condition expressionLanguage="urn:oasis:names:tc:ws2.0:sublang:xpath1.0"><![CDATA[$valid='V']]></condition>
                            <sequence name="InvokeProcessRequest">
	                            
	                            	<assign validate="no" name="PrepareProcessRequest">
		                                <copy>
	    	                                <from>
	    	                                	<literal><impl:processRequest xmlns:impl="http://request.ws.ou" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
												  <impl:requestInput>
												    <impl:payload>impl:payload</impl:payload>
												  </impl:requestInput>
												</impl:processRequest>
												</literal>
											</from>
	                                    	<to variable="handleRequestWSRequest" part="parameters"></to>
	                                	</copy>
	                                	
	                                	<copy>
	                                    	<from variable="payload"></from>
	                                    	<to part="parameters" variable="handleRequestWSRequest">
	                                        	<query queryLanguage="urn:oasis:names:tc:ws2.0:sublang:xpath1.0"><![CDATA[ns:requestInput/ns:payload]]></query>
	                                    	</to>
	                                	</copy>
	                            	</assign>
	                            	
	                            	<invoke name="ProcessRequestWS" partnerLink="HandleRequestWSPL" operation="processRequest" portType="ns:HandleRequestWS" inputVariable="handleRequestWSRequest" outputVariable="handleRequestWSResponse">
	                            	<catch faultName="ns:WsException" faultVariable="exception" faultMessageType="ns:WsException">
	                                	<sequence name="CreateExceptionTask">
	                                		<assign validate="no" name="PrepareExceptionTask">
	                                            
	                                            <copy>
	                                        		<from>
	                                        			<literal><impl:createExceptionTask xmlns:impl="http://request.ws.ou" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
														  <impl:requestInput>
														    <impl:exceptionPoint>impl:exceptionPoint</impl:exceptionPoint>
														    <impl:payload>impl:payload</impl:payload>
														    <impl:triggerEvent>impl:triggerEvent</impl:triggerEvent>
														  </impl:requestInput>
														</impl:createExceptionTask>
														</literal>
													</from>
	                                        		<to variable="createExceptionTaskWSRequest" part="parameters"></to>
	                                    		</copy>
	                                    		
			                                    <copy>
			                                        <from variable="service"></from>
			                                        <to part="parameters" variable="createExceptionTaskWSRequest">
			                                                    <query queryLanguage="urn:oasis:names:tc:ws2.0:sublang:xpath1.0">
			                                                        <![CDATA[ns:requestInput/ns:triggerEvent]]>
			                                                    </query>
	                                                </to>
			                                    </copy>
			                                </assign>
			                                
	                                		<invoke name="InvokeCreateExceptionTask" partnerLink="HandleRequestWSPL" operation="createExceptionTask" portType="ns:HandleRequestWS" inputVariable="createExceptionTaskWSRequest" outputVariable="createExceptionTaskWSResponse"></invoke>
	                                		<throw name="StopProcess"></throw>              
	                            	    </sequence>
	                            	</catch>
	 	                       		</invoke>
	                      		</sequence>
                      		<!-- "InvokeProcessRequest"> -->
	                        
                 		<else>
                    		<sequence name="InvokeRejectRequest">
	                        		<assign validate="no" name="PrepareRejectReq">
	
	                                    <copy>
	                                        <from>
	                                        	<literal><impl:rejectRequestWS xmlns:impl="http://request.ws.ou" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
													  <impl:requestInput>
													    <impl:payload>impl:payload</impl:payload>
													  </impl:requestInput>
													</impl:rejectRequestWS>
													</literal>
											</from>
	                                        <to variable="rejectRequestWSReq" part="parameters"></to>
	                                    </copy>
	                                    
	                                    <copy>
	                                        <from variable="payload"></from>
	                                        <to part="parameters" variable="rejectRequestWSReq">
	                                            <query queryLanguage="urn:oasis:names:tc:ws2.0:sublang:xpath1.0"><![CDATA[ns:requestInput/ns:payload]]></query>
	                                        </to>
	                                    </copy>
	                                    
	                                </assign>
	                                
	                                <invoke name="RejectRequestWS" partnerLink="HandleRequestWSPL" operation="rejectRequestWS" portType="ns:HandleRequestWS" inputVariable="rejectRequestWSReq" outputVariable="rejectRequestWSResp">
	                            	<catch faultName="ns:WsException" faultVariable="exception" faultMessageType="ns:WsException">
	                                	<sequence name="CreateExceptionTask">
	                                		<assign validate="no" name="PrepareExceptionTask">
	                                        	<copy>
	                                            	<from>
	                                            		<literal><impl:createExceptionTask xmlns:impl="http://request.ws.ou" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
															  <impl:requestInput>
															    <impl:exceptionPoint>impl:exceptionPoint</impl:exceptionPoint>
															    <impl:payload>impl:payload</impl:payload>
															    <impl:triggerEvent>impl:triggerEvent</impl:triggerEvent>
															  </impl:requestInput>
															</impl:createExceptionTask>
														</literal>
													</from>
	                                                <to variable="createExceptionTaskWSRequest" part="parameters"></to>
	                                         	</copy>
	                                                
			                                    <copy>
	        		                                <from variable="service"></from>
	                		                        <to part="parameters" variable="createExceptionTaskWSRequest">
	                                                        <query queryLanguage="urn:oasis:names:tc:ws2.0:sublang:xpath1.0">
	                                                            <![CDATA[ns:requestInput/ns:triggerEvent]]>
	                                                        </query>
	                                                </to>
	                        		            </copy>
	                                		</assign>
	                                		
			                                <invoke name="InvokeCreateExceptionTask" partnerLink="HandleRequestWSPL" operation="createExceptionTask" portType="ns:HandleRequestWS" inputVariable="createExceptionTaskWSRequest" outputVariable="createExceptionTaskWSResponse"></invoke>
	        		                        <throw name="StopProcess"></throw>
	                           
	                	                </sequence>
	                            </catch>
	                        	</invoke>
	                   		</sequence>
                   		</else>
                   		</if>
                   	</sequence>	
            
        		<else>
                	<sequence name="CreateManualTask">
                    	<sequence name="InvokeCreateManualTask">
                        	<assign validate="no" name="PrepareCreateManualTask">
                             	<copy>
                                	<from>
                                    	<literal><impl:createManualTask xmlns:impl="http://request.ws.ou" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
												  <impl:requestInput>
												    <impl:payload>impl:payload</impl:payload>
												  </impl:requestInput>
												</impl:createManualTask>
												</literal>
									</from>
                                    <to variable="createManualTaskWSRequest" part="parameters"></to>
                             	</copy>
                                    
                                <copy>
                                	<from variable="payload"></from>
                                    <to part="parameters" variable="createManualTaskWSRequest">
                                            <query queryLanguage="urn:oasis:names:tc:ws2.0:sublang:xpath1.0"><![CDATA[ns:requestInput/ns:payload]]></query>
                                    </to>
                                </copy>
                          	</assign>
                          	
                          	<invoke name="CreateManualTaskWS" partnerLink="HandleRequestWSPL" operation="createManualTask" portType="ns:HandleRequestWS" inputVariable="createManualTaskWSRequest" outputVariable="createManualTaskWSResponse">
                            <catch faultName="ns:WsException" faultVariable="exception" faultMessageType="ns:WsException">
                                <sequence name="CreateExceptionTask">
                                	<assign validate="no" name="PrepareExceptionTask">
                                    	<copy>
                                        	<from>
                                        		<literal>
                                        			<impl:createExceptionTask xmlns:impl="http://request.ws.ou" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
														  <impl:requestInput>
														    <impl:exceptionPoint>impl:exceptionPoint</impl:exceptionPoint>
														    <impl:payload>impl:payload</impl:payload>
														    <impl:triggerEvent>impl:triggerEvent</impl:triggerEvent>
														  </impl:requestInput>
														</impl:createExceptionTask>
												</literal>
											</from>
                                            <to variable="createExceptionTaskWSRequest" part="parameters"></to>
                                     	</copy>
                                            
	                                    <copy>
    	                                    <from variable="service"></from>
        	                                <to part="parameters" variable="createExceptionTaskWSRequest">
                                                        <query queryLanguage="urn:oasis:names:tc:ws2.0:sublang:xpath1.0">
                                                            <![CDATA[ns:requestInput/ns:triggerEvent]]>
                                                        </query>
                	                      	</to>
            	                		</copy>
                                	</assign>
                                
                                	<invoke name="InvokeCreateExceptionTask" partnerLink="HandleRequestWSPL" operation="createExceptionTask" portType="ns:HandleRequestWS" inputVariable="createExceptionTaskWSRequest" outputVariable="createExceptionTaskWSResponse"></invoke>
                                	<throw name="StopProcess"></throw>
                            
                        		</sequence>
                            </catch>
                        	</invoke>
    					</sequence>
    					<!-- "InvokeCreateManualTask"> -->
                            
                   	</sequence>
                   	<!-- "CreateManualTask"> -->
                </else>
                </if>
                
                <if name="NotReinjectHandleRequest">
                    <condition expressionLanguage="urn:oasis:names:tc:ws2.0:sublang:xpath1.0"><![CDATA[$reinject='N']]></condition>
                    <sequence name="Reply">
                        <assign validate="no" name="PrepareHandleRequestReply">
                    		<copy>
                        		<from>
                        			<literal><tns:HandleRequestResponse xmlns:tns="http://handerequest.ws.ou" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  										<tns:result>tns:result</tns:result>
										</tns:HandleRequestResponse>
									</literal>
								</from>
                        		<to variable="handleRequestOutput" part="parameters"></to>
                    		</copy>
                    
                    		<copy>
                        		<from variable="ok"></from>
                        		<to part="parameters" variable="handleRequestOutput">
                            		<query queryLanguage="urn:oasis:names:tc:ws2.0:sublang:xpath1.0"><![CDATA[tns:result]]></query>
                        		</to>
                    		</copy>
                        </assign>
                        
                        <reply name="HandleRequestReply" partnerLink="client" operation="handleRequest" portType="tns:HandleRequest" variable="handleRequestOutput"></reply>
                    </sequence>
                </if>
        	</sequence>
            <!-- "HandleRequestSequence"> -->
            
            <elseif>
                <condition expressionLanguage="urn:oasis:names:tc:ws2.0:sublang:xpath1.0"><![CDATA[$service='handleComplexRequest']]></condition>
                <sequence name="HandleComplexRequestSequence">
                    
                    <sequence name="InvokeCheckProcessability">
                        <assign validate="no" name="PrepareCheckProcessability">
                        
                    
                            <copy>
                                <from><literal><impl:checkProcessability xmlns:impl="http://request.ws.ou" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <impl:requestInput>
    <impl:payload>impl:payload</impl:payload>
  </impl:requestInput>
</impl:checkProcessability>
</literal></from>
                                <to variable="checkProcessabilityWSRequest" part="parameters"></to>
                            </copy>
                            <copy>
                                <from variable="payload"></from>
                                <to part="parameters" variable="checkProcessabilityWSRequest">
                                    <query queryLanguage="urn:oasis:names:tc:ws2.0:sublang:xpath1.0"><![CDATA[ns:requestInput/ns:payload]]></query>
                                </to>
                            </copy>
                            
                            
                        </assign><invoke name="CheckProcessabilityWS" partnerLink="HandleRequestWSPL" operation="checkProcessability" portType="ns:HandleRequestWS" inputVariable="checkProcessabilityWSRequest" outputVariable="checkProcessabilityWSResponse">
                            <catch faultName="ns:WsException" faultVariable="exception" faultMessageType="ns:WsException">
                                <sequence name="CreateExceptionTask"><assign validate="no" name="PrepareExceptionTask">
                                    <copy>
                                        <from><literal><impl:createExceptionTask xmlns:impl="http://request.ws.ou" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <impl:requestInput>
    <impl:exceptionPoint>impl:exceptionPoint</impl:exceptionPoint>
    <impl:payload>impl:payload</impl:payload>
    <impl:triggerEvent>impl:triggerEvent</impl:triggerEvent>
  </impl:requestInput>
</impl:createExceptionTask>
</literal></from>
                                        <to variable="createExceptionTaskWSRequest" part="parameters"></to>
                                    </copy>
                                    <copy>
                                        <from variable="service"></from>
                                        <to part="parameters" variable="createExceptionTaskWSRequest">
                                            <query queryLanguage="urn:oasis:names:tc:ws2.0:sublang:xpath1.0"><![CDATA[ns:requestInput/ns:triggerEvent]]></query>
                                        </to>
                                    </copy>
                                </assign>
                                <invoke name="InvokeCreateExceptionTask" partnerLink="HandleRequestWSPL" operation="createExceptionTask" portType="ns:HandleRequestWS" inputVariable="createExceptionTaskWSRequest" outputVariable="createExceptionTaskWSResponse"></invoke>
                                <throw name="StopProcess"></throw>
                            
                                </sequence>
                            </catch>
                        </invoke>
    
    

                    
                        <assign validate="no" name="AssignValid">
                            <copy>
                                <from part="parameters" variable="checkProcessabilityWSResponse">
                                    <query queryLanguage="urn:oasis:names:tc:ws2.0:sublang:xpath1.0"><![CDATA[ns:checkProcessabilityReturn/ns:value]]></query>
                                </from>
                                <to variable="valid"></to>
                            </copy>
                        </assign>
                    </sequence>
                    <if name="IfValidComplex">
                        <condition expressionLanguage="urn:oasis:names:tc:ws2.0:sublang:xpath1.0"><![CDATA[$valid='V']]></condition>
                        <sequence name="InvokeProcessRequest"><assign validate="no" name="PrepareProcessRequest">
                        
                    
                            
                            
                                <copy>
                                    <from><literal><impl:processRequest xmlns:impl="http://request.ws.ou" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <impl:requestInput>
    <impl:payload>impl:payload</impl:payload>
  </impl:requestInput>
</impl:processRequest>
</literal></from>
                                    <to variable="handleRequestWSRequest" part="parameters"></to>
                                </copy>
                                <copy>
                                    <from variable="payload"></from>
                                    <to part="parameters" variable="handleRequestWSRequest">
                                        <query queryLanguage="urn:oasis:names:tc:ws2.0:sublang:xpath1.0"><![CDATA[ns:requestInput/ns:payload]]></query>
                                    </to>
                                </copy>
                            </assign><invoke name="ProcessRequestWS" partnerLink="HandleRequestWSPL" operation="processRequest" portType="ns:HandleRequestWS" inputVariable="handleRequestWSRequest" outputVariable="handleRequestWSResponse">
                            <catch faultName="ns:WsException" faultVariable="exception" faultMessageType="ns:WsException">
                                <sequence name="CreateExceptionTask"><assign validate="no" name="PrepareExceptionTask">
                                            
                                            <copy>
                                        <from><literal><impl:createExceptionTask xmlns:impl="http://request.ws.ou" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <impl:requestInput>
    <impl:exceptionPoint>impl:exceptionPoint</impl:exceptionPoint>
    <impl:payload>impl:payload</impl:payload>
    <impl:triggerEvent>impl:triggerEvent</impl:triggerEvent>
  </impl:requestInput>
</impl:createExceptionTask>
</literal></from>
                                        <to variable="createExceptionTaskWSRequest" part="parameters"></to>
                                    </copy>
                                    <copy>
                                        <from variable="service"></from>
                                        <to part="parameters" variable="createExceptionTaskWSRequest">
                                                    <query queryLanguage="urn:oasis:names:tc:ws2.0:sublang:xpath1.0">
                                                        <![CDATA[ns:requestInput/ns:triggerEvent]]>
                                                    </query>
                                                </to>
                                    </copy>
                                </assign>
                                <invoke name="InvokeCreateExceptionTask" partnerLink="HandleRequestWSPL" operation="createExceptionTask" portType="ns:HandleRequestWS" inputVariable="createExceptionTaskWSRequest" outputVariable="createExceptionTaskWSResponse"></invoke>
                                <throw name="StopProcess"></throw>
                            
                                </sequence>
                            </catch>
                        </invoke>
    
    

                    
                    
                        </sequence>
                        <else>
                            <sequence name="InvokeRejectRequest">
                        <assign validate="no" name="PrepareRejectReq">
                        
                    
                            
                            
                                    <copy>
                                        <from><literal><impl:rejectRequestWS xmlns:impl="http://request.ws.ou" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <impl:requestInput>
    <impl:payload>impl:payload</impl:payload>
  </impl:requestInput>
</impl:rejectRequestWS>
</literal></from>
                                        <to variable="rejectRequestWSReq" part="parameters"></to>
                                    </copy>
                                    <copy>
                                        <from variable="payload"></from>
                                        <to part="parameters" variable="rejectRequestWSReq">
                                            <query queryLanguage="urn:oasis:names:tc:ws2.0:sublang:xpath1.0"><![CDATA[ns:requestInput/ns:payload]]></query>
                                        </to>
                                    </copy>
                                </assign><invoke name="RejectRequestWS" partnerLink="HandleRequestWSPL" operation="rejectRequestWS" portType="ns:HandleRequestWS" inputVariable="rejectRequestWSReq" outputVariable="rejectRequestWSResp">
                            <catch faultName="ns:WsException" faultVariable="exception" faultMessageType="ns:WsException">
                                <sequence name="CreateExceptionTask"><assign validate="no" name="PrepareExceptionTask">
                                                <copy>
                                                    <from><literal><impl:createExceptionTask xmlns:impl="http://request.ws.ou" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <impl:requestInput>
    <impl:exceptionPoint>impl:exceptionPoint</impl:exceptionPoint>
    <impl:payload>impl:payload</impl:payload>
    <impl:triggerEvent>impl:triggerEvent</impl:triggerEvent>
  </impl:requestInput>
</impl:createExceptionTask>
</literal></from>
                                                    <to variable="createExceptionTaskWSRequest" part="parameters"></to>
                                                </copy>
                                                
                                    <copy>
                                        <from variable="service"></from>
                                        <to part="parameters" variable="createExceptionTaskWSRequest">
                                                        <query queryLanguage="urn:oasis:names:tc:ws2.0:sublang:xpath1.0">
                                                            <![CDATA[ns:requestInput/ns:triggerEvent]]>
                                                        </query>
                                                    </to>
                                    </copy>
                                </assign>
                                <invoke name="InvokeCreateExceptionTask" partnerLink="HandleRequestWSPL" operation="createExceptionTask" portType="ns:HandleRequestWS" inputVariable="createExceptionTaskWSRequest" outputVariable="createExceptionTaskWSResponse"></invoke>
                                <throw name="StopProcess"></throw>
                            
                                </sequence>
                            </catch>
                        </invoke>
    
    

                    
                    </sequence>
                        </else>
                    </if>
                    <if name="NotReinjectHandleComplexRequest">
                        <condition expressionLanguage="urn:oasis:names:tc:ws2.0:sublang:xpath1.0"><![CDATA[$reinject='N']]></condition>
                        <sequence name="Reply">
                            <assign validate="no" name="PrepareHandleComplexRequestReply">
                                <copy>
                                    <from><literal><tns:HandleComplexRequestResponse xmlns:tns="http://handerequest.ws.ou" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <tns:result>tns:result</tns:result>
</tns:HandleComplexRequestResponse>
</literal></from>
                                    <to variable="handleComplexRequestOutput" part="parameters"></to>
                                </copy>
                                <copy>
                                    <from variable="ok"></from>
                                    <to part="parameters" variable="handleComplexRequestOutput">
                                        <query queryLanguage="urn:oasis:names:tc:ws2.0:sublang:xpath1.0"><![CDATA[tns:result]]></query>
                                    </to>
                                </copy>
                            </assign>
                            <reply name="HandleComplexRequestReply" partnerLink="client" operation="handleComplexRequest" portType="tns:HandleRequest" variable="handleComplexRequestOutput"></reply>
                        </sequence>
                    </if>
                    
                </sequence>
            </elseif>

            <elseif>
                <condition expressionLanguage="urn:oasis:names:tc:ws2.0:sublang:xpath1.0"><![CDATA[$service='rejectRequest']]></condition>
                <sequence name="RejectRequestSequence">
                    <sequence name="InvokeRejectRequest">
                        <assign validate="no" name="PrepareInvokeRejectRequest">
                        
                        <copy>
                            <from><literal><impl:rejectRequestWS xmlns:impl="http://request.ws.ou" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <impl:requestInput>
    <impl:payload>impl:payload</impl:payload>
  </impl:requestInput>
</impl:rejectRequestWS>
</literal></from>
                            <to variable="rejectRequestWSReq" part="parameters"></to>
                        </copy>
                        <copy>
                            <from variable="payload"></from>
                            <to part="parameters" variable="rejectRequestWSReq">
                                <query queryLanguage="urn:oasis:names:tc:ws2.0:sublang:xpath1.0"><![CDATA[ns:requestInput/ns:payload]]></query>
                            </to>
                        </copy>
                    </assign>
                        <invoke name="InvokeRejectRequestWS" partnerLink="HandleRequestWSPL" operation="rejectRequestWS" portType="ns:HandleRequestWS" inputVariable="rejectRequestWSReq" outputVariable="rejectRequestWSResp">
                            <catch faultName="ns:WsException" faultVariable="exception" faultMessageType="ns:WsException">
                                <sequence name="CreateExceptionTask"><assign validate="no" name="PrepareExceptionTask">
                                    <copy>
                                        <from><literal><impl:createExceptionTask xmlns:impl="http://request.ws.ou" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <impl:requestInput>
    <impl:exceptionPoint>impl:exceptionPoint</impl:exceptionPoint>
    <impl:payload>impl:payload</impl:payload>
    <impl:triggerEvent>impl:triggerEvent</impl:triggerEvent>
  </impl:requestInput>
</impl:createExceptionTask>
</literal></from>
                                        <to variable="createExceptionTaskWSRequest" part="parameters"></to>
                                    </copy>
                                    <copy>
                                        <from variable="service"></from>
                                        <to part="parameters" variable="createExceptionTaskWSRequest">
                                            <query queryLanguage="urn:oasis:names:tc:ws2.0:sublang:xpath1.0"><![CDATA[ns:requestInput/ns:triggerEvent]]></query>
                                        </to>
                                    </copy>
                                </assign>
                                <invoke name="InvokeCreateExceptionTask" partnerLink="HandleRequestWSPL" operation="createExceptionTask" portType="ns:HandleRequestWS" inputVariable="createExceptionTaskWSRequest" outputVariable="createExceptionTaskWSResponse"></invoke>
                                <throw name="StopProcess"></throw>
                            
                                </sequence>
                            </catch>
                        </invoke>
                    </sequence>
                    
                    
                    <if name="NotReinjectRejectRequest">
                        <condition expressionLanguage="urn:oasis:names:tc:ws2.0:sublang:xpath1.0"><![CDATA[$reinject='N']]></condition>
                        <sequence name="Reply">
                            <assign validate="no" name="PrepareRejectRequestReply">
                                <copy>
                                    <from><literal><tns:RejectRequestResponse xmlns:tns="http://handerequest.ws.ou" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <tns:result>tns:result</tns:result>
</tns:RejectRequestResponse>
</literal></from>
                                    <to variable="rejectRequestOutput" part="parameters"></to>
                                </copy>
                                <copy>
                                    <from variable="ok"></from>
                                    <to part="parameters" variable="rejectRequestOutput">
                                        <query queryLanguage="urn:oasis:names:tc:ws2.0:sublang:xpath1.0"><![CDATA[tns:result]]></query>
                                    </to>
                                </copy>
                            </assign>
                            <reply name="RejectRequestReply" partnerLink="client" operation="rejectRequest" portType="tns:HandleRequest" variable="rejectRequestOutput"></reply>
                        </sequence>
                    </if>
                </sequence>
            </elseif><else>
                <assign validate="no" name="UnknownRequest">
                    <copy>
                        <from>
                            <literal xml:space="preserve">Error</literal>
                        </from>
                        <to variable="ok"></to>
                    </copy>
                    
                </assign>
            </else></if>
        <if name="IfReinject">
            <condition expressionLanguage="urn:oasis:names:tc:ws2.0:sublang:xpath1.0"><![CDATA[$reinject='Y']]></condition>
            <sequence name="ReplyReinject">
                <assign validate="no" name="PrepareReinjectRequestReply"><copy>
                <from><literal><tns:ReinjectRequestResponse xmlns:tns="http://handerequest.ws.ou" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <tns:result>tns:result</tns:result>
</tns:ReinjectRequestResponse>
</literal></from>
                <to variable="reinjectRequestOutput" part="parameters"></to>
            </copy>
            <copy>
                <from variable="ok"></from>
                <to part="parameters" variable="reinjectRequestOutput">
                    <query queryLanguage="urn:oasis:names:tc:ws2.0:sublang:xpath1.0">
                        <![CDATA[tns:result]]>
                    </query>
                </to>
            </copy>
        
            </assign>
                <reply name="ReinjectRequestReply" partnerLink="client" operation="reinjectRequest" portType="tns:HandleRequest" variable="reinjectRequestOutput"></reply>
            </sequence>
        </if>
        
        
    </sequence>
</process>

